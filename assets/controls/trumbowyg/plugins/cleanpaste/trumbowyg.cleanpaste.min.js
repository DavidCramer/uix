(function($){"use strict";function reverse(sentString){var theString="";for(var i=sentString.length-1;i>=0;i-=1){theString+=sentString.charAt(i)}return theString}function checkValidTags(snippet){var theString=snippet;theString=theString.replace(/<[^> ]*/g,function(match){return match.toLowerCase()});theString=theString.replace(/<[^>]*>/g,function(match){match=match.replace(/ [^=]+=/g,function(match2){return match2.toLowerCase()});return match});theString=theString.replace(/<[^>]*>/g,function(match){match=match.replace(/( [^=]+=)([^"][^ >]*)/g,'$1"$2"');return match});return theString}function cleanIt(htmlBefore,htmlAfter){var matchedHead="";var matchedTail="";var afterStart;var afterFinish;var newSnippet;for(afterStart=0;htmlAfter.charAt(afterStart)===htmlBefore.charAt(afterStart);afterStart+=1){matchedHead+=htmlAfter.charAt(afterStart)}for(var i=afterStart;i>=0;i-=1){if(htmlBefore.charAt(i)==="<"){afterStart=i;matchedHead=htmlBefore.substring(0,afterStart);break}else if(htmlBefore.charAt(i)===">"){break}}htmlAfter=reverse(htmlAfter);htmlBefore=reverse(htmlBefore);for(afterFinish=0;htmlAfter.charAt(afterFinish)===htmlBefore.charAt(afterFinish);afterFinish+=1){matchedTail+=htmlAfter.charAt(afterFinish)}for(var j=afterFinish;j>=0;j-=1){if(htmlBefore.charAt(j)===">"){afterFinish=j;matchedTail=htmlBefore.substring(0,afterFinish);break}else if(htmlBefore.charAt(j)==="<"){break}}matchedTail=reverse(matchedTail);if(afterStart===htmlAfter.length-afterFinish){return false}htmlAfter=reverse(htmlAfter);newSnippet=htmlAfter.substring(afterStart,htmlAfter.length-afterFinish);newSnippet=checkValidTags(newSnippet);newSnippet=newSnippet.replace(/<b(\s+|>)/g,"<strong$1");newSnippet=newSnippet.replace(/<\/b(\s+|>)/g,"</strong$1");newSnippet=newSnippet.replace(/<i(\s+|>)/g,"<em$1");newSnippet=newSnippet.replace(/<\/i(\s+|>)/g,"</em$1");newSnippet=newSnippet.replace(/<!(?:--[\s\S]*?--\s*)?>\s*/g,"");newSnippet=newSnippet.replace(/&nbsp;/gi," ");newSnippet=newSnippet.replace(/ <\//gi,"</");while(newSnippet.indexOf("  ")!==-1){var anArray=newSnippet.split("  ");newSnippet=anArray.join(" ")}newSnippet=newSnippet.replace(/^\s*|\s*$/g,"");newSnippet=newSnippet.replace(/<[^>]*>/g,function(match){match=match.replace(/ ([^=]+)="[^"]*"/g,function(match2,attributeName){if(["alt","href","src","title"].indexOf(attributeName)!==-1){return match2}return""});return match});newSnippet=newSnippet.replace(/<\?xml[^>]*>/g,"");newSnippet=newSnippet.replace(/<[^ >]+:[^>]*>/g,"");newSnippet=newSnippet.replace(/<\/[^ >]+:[^>]*>/g,"");newSnippet=newSnippet.replace(/<(div|span|style|meta|link){1}.*?>/gi,"");htmlAfter=matchedHead+newSnippet+matchedTail;return htmlAfter}$.extend(true,$.trumbowyg,{plugins:{cleanPaste:{init:function(trumbowyg){trumbowyg.pasteHandlers.push(function(){try{var contentBefore=trumbowyg.$ed.html();setTimeout(function(){var contentAfter=trumbowyg.$ed.html();contentAfter=cleanIt(contentBefore,contentAfter);trumbowyg.$ed.html(contentAfter)},0)}catch(c){}})}}}})})(jQuery);