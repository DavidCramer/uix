var conduitApp={},conduitRegisterApps,conduitGetData;!jQuery(function(a){conduitGeneralBaldrick=function(){a(".wp-baldrick").baldrick({method:"POST",before:function(t){var n=a(t),e=n.closest("[data-app]");e.length?n.data("data",JSON.stringify(conduitBuildData(e.data("app")))):n.data("data")&&n.data("data",JSON.stringify(conduitBuildData(n.data("data"))))}})},conduitGetData=function(a){var t=a.trigger.data("app"),n={};return console.log("getting data for "+t),conduitApp[t]&&conduitApp[t].data?conduitApp[t].data:n},conduitBuildData=function(a){return conduitApp[a]&&conduitApp[a].app&&(conduitApp[a].data=conduitApp[a].app.formJSON()),conduitApp[a].data},conduitSyncData=function(a){conduitBuildData(a),conduitBuildUI(a)},conduitRegisterApps=function(){var t=a("[data-app]").not("._bound_app");t.length&&t.each(function(){var t=a(this),n=t.data("app"),e=t.formJSON();conduitApp[n]={app:t,data:e.init?e.init:e},t.addClass("_bound_app").addClass("app-"+n).data({template:"#"+n+"-template",request:"conduitGetData"}),a(".app-"+n).baldrick({method:"POST",target:this,event:"refresh",callback:function(){conduitRegisterApps(),conduitGeneralBaldrick()}}).trigger("refresh")})},conduitBuildUI=function(t){a(".app-"+t).trigger("refresh")},conduitAddNode=function(t,n){var e="nd"+Math.round(99866*Math.random())+Math.round(99866*Math.random()),d=t.data("addNode").split("."),i=t.data("nodeDefault"),o=d.join(".")+"."+e,c=JSON.parse('{ "_id" : "'+e+'", "_node_point" : "'+o+'" }');i&&"object"==typeof i&&a.extend(!0,c,i);for(var r='{ "'+d.join('": { "')+'" : { "'+e+'" : '+JSON.stringify(c),p=0;p<=d.length;p++)r+="}";var u=JSON.parse(r);a.extend(!0,conduitApp[n].data,u),conduitBuildUI(n)},a(document).on("click",".cf-reports-card-actions .confirm a",function(t){t.preventDefault();var n=a(this).closest(".cf-reports-card-content");actions=n.find(".row-actions"),actions.slideToggle(300)}),a(document).on("keyup change",'[data-format="slug"]',function(t){var n=a(this);return n.data("master")&&n.prop("required")&&this.value.length<=0&&"change"===t.type?(this.value=a(n.data("master")).val().replace(/[^a-z0-9]/gi,"_").toLowerCase(),void(this.value.length&&n.trigger("change"))):void(this.value=this.value.replace(/[^a-z0-9]/gi,"_").toLowerCase())}),a(document).on("keyup change","[data-sync]",function(){var t=a(this),n=a(t.data("sync"));n.each(function(){var n=a(this);n.is("input")?n.val(t.val()).trigger("change"):n.text(t.val())})}),a(document).on("click","[data-add-node]",function(t){var n=a(this),e=n.closest("[data-app]").data("app");e&&"object"==typeof conduitApp[e]&&(t.preventDefault(),conduitAddNode(n,e))}),a(document).on("click","[data-remove-element]",function(t){var n=a(this),e=n.closest("[data-app]").data("app"),d=a(n.data("removeElement"));(!n.data("confirm")||confirm(n.data("confirm")))&&(d.remove(),conduitSyncData(e))}),a(document).on("change","[data-live-sync]",function(t){var n=a(this).closest("[data-app]").data("app");conduitSyncData(n)}),a("script[data-handlebars-partial]").each(function(){var t=a(this);Handlebars.registerPartial(t.data("handlebarsPartial"),t.html())}),conduitRegisterApps()});