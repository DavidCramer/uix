var conduitApp={},coduitTemplates={},conduitRegisterApps,conduitGetData;!jQuery(function(a){a.fn.conduitTrigger=function(b){var c={method:"GET"};return a.extend(!0,c,b),this},a.fn.getObject=function(){for(var b=a(this),c=b.find("[name]"),d={},e={},f=0;f<c.length;f++){var g=a(c[f]),h=g.prop("name").replace(/\]/gi,"").split("["),i=g.val(),j={};if(!g.is(":radio")&&!g.is(":checkbox")||g.is(":checked")){for(var k=h.length-1;k>=0;k--){var l=h[k];if("undefined"==typeof l&&(l=""),0===l.length&&(j=[],"undefined"==typeof e[h[k-1]]?e[h[k-1]]=0:e[h[k-1]]+=1,l=e[h[k-1]]),k===h.length-1){if(i)if("true"===i)i=!0;else if("false"===i)i=!1;else if(isNaN(parseFloat(i))||parseFloat(i).toString()!==i)if("string"!=typeof i||"{"!==i.substr(0,1)&&"["!==i.substr(0,1)){if("object"==typeof i&&i.length&&g.is("select")){for(var m={},k=0;k<i.length;k++)m["n"+k]=i[k];i=m}}else try{i=JSON.parse(i)}catch(n){}else i=parseFloat(i);j[l]=i}else{var o=j;j={},j[l]=o}}a.extend(!0,d,j)}}return d},conduitGeneralBaldrick=function(){a(".wp-trigger").conduitTrigger({method:"POST",before:function(b){var c=a(b),d=c.closest("[data-app]");d.length?c.data("data",JSON.stringify(conduitBuildData(d.data("app")))):c.data("data")&&c.data("data",JSON.stringify(conduitBuildData(c.data("data"))))}})},conduitPrepObject=function(){var a={};for(var b in conduitApp)conduitApp[b].app&&(conduitApp[b].app.is(":visible")?a[b]=conduitBuildData(b):a[b]=conduitApp[b].data);return a},conduitGetData=function(a){var b=a.trigger.data("app"),c={};return conduitApp[b]&&conduitApp[b].data?conduitApp[b].data:c},conduitBuildData=function(a){return conduitApp[a]&&conduitApp[a].app&&(conduitApp[a].data=conduitApp[a].app.getObject()),conduitApp[a].data},conduitSyncData=function(a){conduitBuildData(a),conduitBuildUI(a)},conduitRegisterApps=function(){var b=a("[data-app]").not("._bound_app");if(b.length&&(b.each(function(){var b=a(this),c=b.data("app");conduitApp[c]={app:b,data:uix.config[c]?uix.config[c]:{}},b.addClass("_bound_app")}),uix.tabs))for(var c in uix.tabs)if(uix.tabs[c]["default"]){a('[data-tab="'+c+'"]').trigger("click");break}},conduitBuildUI=function(a){if(conduitApp[a]){var b=conduitApp[a].data;b._tab={};for(var c in conduitApp)c!==a&&(b._tab[c]=conduitApp[c].data);conduitApp[a].app.html(coduitTemplates[a](b))}},conduitAddNode=function(b,c){var d="nd"+Math.round(99866*Math.random())+Math.round(99866*Math.random()),e=b.data("addNode").split("."),f=b.data("nodeDefault"),g=e.join(".")+"."+d,h=JSON.parse('{ "_id" : "'+d+'", "_node_point" : "'+g+'" }');f&&"object"==typeof f&&a.extend(!0,h,f);for(var i='{ "'+e.join('": { "')+'" : { "'+d+'" : '+JSON.stringify(h),j=0;j<=e.length;j++)i+="}";var k=JSON.parse(i);conduitBuildData(c),a.extend(!0,conduitApp[c].data,k),conduitBuildUI(c)},a(document).on("click",".cf-reports-card-actions .confirm a",function(b){b.preventDefault();var c=a(this).closest(".cf-reports-card-content");actions=c.find(".row-actions"),actions.slideToggle(300)}),a(document).on("keyup change",'[data-format="slug"]',function(b){var c=a(this);return c.data("master")&&c.prop("required")&&this.value.length<=0&&"change"===b.type?(this.value=a(c.data("master")).val().replace(/[^a-z0-9]/gi,"_").toLowerCase(),void(this.value.length&&c.trigger("change"))):void(this.value=this.value.replace(/[^a-z0-9]/gi,"_").toLowerCase())}),a(document).on("keyup change","[data-sync]",function(){var b=a(this),c=a(b.data("sync"));c.each(function(){var c=a(this);c.is("input")?c.val(b.val()).trigger("change"):c.text(b.val())})}),a(document).on("click","[data-add-node]",function(b){var c=a(this),d=c.closest("[data-app]").data("app");d&&"object"==typeof conduitApp[d]&&(b.preventDefault(),conduitAddNode(c,d))}),a(document).on("click","[data-remove-element]",function(b){var c=a(this),d=c.closest("[data-app]").data("app"),e=a(c.data("removeElement"));(!c.data("confirm")||confirm(c.data("confirm")))&&(e.remove(),conduitSyncData(d))}),a(document).on("click","[data-save-object]",function(b){b.preventDefault();var c,d=(a(this),a(this).data("saveObject"));c=!0===d?conduitPrepObject():conduitPrepObject(d);var e={action:"uix_save_config",uix_setup:a("#uix_setup").val(),page_slug:uix.page_slug,config:JSON.stringify(c)};a.post(ajaxurl,e,function(a){console.log(a)})}),a(document).on("change","[data-live-sync]",function(b){var c=a(this).closest("[data-app]").data("app");conduitSyncData(c)}),a(document).on("click","[data-tab]",function(b){b.preventDefault();var c=a(this),d=c.data("tab"),e=a(".active[data-tab]").data("tab");if(e){if(conduitBuildData(e),e===d)return;a('[data-app="'+e+'"]').empty().hide()}a("[data-tab]").removeClass("active"),a('[data-app="'+d+'"]').show(),c.addClass("active"),conduitBuildUI(d)}),a("script[data-template]").each(function(){var b=a(this),c=b.data("template");coduitTemplates[c]=Handlebars.compile(b.html(),{data:!0,trackIds:!0})}),a("script[data-handlebars-partial]").each(function(){var b=a(this);Handlebars.registerPartial(b.data("handlebarsPartial"),b.html())}),conduitRegisterApps()});